#!/usr/bin/env python3
# coding:utf-8
import requests
import re

# variables applicatives
regex = "picoCTF{.*?}"
regbot = "/.*?.html"
url = "https://2019shell1.picoctf.com/problem/47235/"
robots = "robots.txt"
s = requests.Session()

# fontion ConnClose, logique de fermeture de la connection


def ConnClose():
    print("[*] Closing connection")
    s.close()
    input()
    quit()


# Fonction Exploit, payload/code à éxécuter, à modifier selon le CTF
def Exploit():
    print("[*] Connection to %s" % url)
    r = s.get(url + robots)
    print("[*] Doing Black magic")
    r = r.content
    b = re.findall(regbot, str(r))
    print("[*] Working hard")
    if not str(b):
        print("[*] No robots.txt value")
    else:
        for i in b:
            r = s.get(url + i)
            r = r.content
            result = re.findall(regex, str(r))
            flag = result
            print("[*] What does the cat says ?")
            if not str(result):
                print("[*] Bad Luck my friend")
            else:
                for f in flag:
                    print("[*] Lucky you, flag is : %s " % f)


# Fonction ConnOpen, logique d'ouverture du stream HTTP vers le serveur
def ConnOpen():
    try:
        Exploit()
    except:
        print("[*] Exploit failed")
    finally:
        ConnClose()


# Program Main
ConnOpen()
